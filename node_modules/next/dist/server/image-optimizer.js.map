{"version":3,"sources":["../../src/server/image-optimizer.ts"],"names":["getHash","detectContentType","ImageOptimizerCache","ImageError","getMaxAge","optimizeImage","imageOptimizer","sendResponse","getImageSize","Deferred","AVIF","WEBP","PNG","JPEG","GIF","SVG","ICO","CACHE_VERSION","ANIMATABLE_TYPES","VECTOR_TYPES","BLUR_IMG_SIZE","BLUR_QUALITY","sharp","require","process","env","NEXT_SHARP_PATH","concurrency","divisor","NODE_ENV","Math","floor","max","cpus","length","e","showSharpMissingWarning","getSupportedMimeType","options","accept","mimeType","mediaType","includes","items","hash","createHash","item","update","String","digest","replace","writeToCacheDir","dir","extension","maxAge","expireAt","buffer","etag","filename","join","promises","rm","force","recursive","catch","rmdir","mkdir","writeFile","every","b","i","validateParams","req","query","nextConfig","isDev","imageData","images","deviceSizes","imageSizes","domains","minimumCacheTTL","formats","remotePatterns","url","w","q","href","errorMessage","Array","isArray","isAbsolute","startsWith","hrefParsed","URL","toString","_error","protocol","hasMatch","width","parseInt","isNaN","sizes","push","isValidSize","quality","headers","isStatic","basePath","getCacheKey","constructor","distDir","cacheDir","get","cacheKey","files","readdir","now","Date","file","maxAgeSt","expireAtSt","split","readFile","Number","value","kind","revalidateAfter","curRevalidate","isStale","_","set","revalidate","Error","err","console","error","statusCode","message","parseCacheControl","str","map","Map","directive","key","trim","toLowerCase","age","endsWith","slice","n","contentType","height","nextConfigOutput","optimizedBuffer","transformer","sequentialRead","rotate","resize","undefined","withoutEnlargement","avif","avifQuality","chromaSubsampling","warn","chalk","yellow","bold","webp","png","jpeg","toBuffer","orientation","getOrientation","operations","Orientation","RIGHT_TOP","type","numRotations","BOTTOM_RIGHT","LEFT_BOTTOM","processBuffer","_req","_res","paramsResult","handleRequest","upstreamBuffer","upstreamType","upstreamRes","fetch","ok","status","Buffer","from","arrayBuffer","mocked","createRequestResponseMocks","method","socket","res","nodeUrl","parse","hasStreamed","concat","buffers","getHeader","cacheControl","dangerouslyAllowSVG","vector","animate","isAnimated","getExtension","output","getMetadata","meta","opts","blurWidth","blurHeight","blurDataURL","unescape","getImageBlurSvg","getFileNameWithExtension","urlWithoutQueryParams","fileNameWithExtension","pop","fileName","setResponseHeaders","xCache","imagesConfig","setHeader","sendEtagResponse","finished","contentDisposition","contentDispositionType","contentSecurityPolicy","getContentType","result","byteLength","end","metadata","decodeBuffer","imageSizeOf","promise","Promise","resolve","reject"],"mappings":"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"}