{"version":3,"sources":["../../src/server/image-optimizer.ts"],"names":["createHash","promises","cpus","mediaType","chalk","contentDisposition","getOrientation","Orientation","imageSizeOf","isAnimated","join","nodeUrl","getImageBlurSvg","hasMatch","createRequestResponseMocks","sendEtagResponse","getContentType","getExtension","AVIF","WEBP","PNG","JPEG","GIF","SVG","ICO","CACHE_VERSION","ANIMATABLE_TYPES","VECTOR_TYPES","BLUR_IMG_SIZE","BLUR_QUALITY","sharp","require","process","env","NEXT_SHARP_PATH","concurrency","divisor","NODE_ENV","Math","floor","max","length","e","showSharpMissingWarning","getSupportedMimeType","options","accept","mimeType","includes","getHash","items","hash","item","update","String","digest","replace","writeToCacheDir","dir","extension","maxAge","expireAt","buffer","etag","filename","rm","force","recursive","catch","rmdir","mkdir","writeFile","detectContentType","every","b","i","ImageOptimizerCache","validateParams","req","query","nextConfig","isDev","imageData","images","deviceSizes","imageSizes","domains","minimumCacheTTL","formats","remotePatterns","url","w","q","href","errorMessage","Array","isArray","isAbsolute","startsWith","hrefParsed","URL","toString","_error","protocol","width","parseInt","isNaN","sizes","push","isValidSize","quality","headers","isStatic","basePath","getCacheKey","constructor","distDir","cacheDir","get","cacheKey","files","readdir","now","Date","file","maxAgeSt","expireAtSt","split","readFile","Number","value","kind","revalidateAfter","curRevalidate","isStale","_","set","revalidate","Error","err","console","error","ImageError","statusCode","message","parseCacheControl","str","map","Map","directive","key","trim","toLowerCase","getMaxAge","age","endsWith","slice","n","optimizeImage","contentType","height","nextConfigOutput","optimizedBuffer","transformer","sequentialRead","rotate","resize","undefined","withoutEnlargement","avif","avifQuality","chromaSubsampling","warn","yellow","bold","webp","png","jpeg","toBuffer","orientation","operations","RIGHT_TOP","type","numRotations","BOTTOM_RIGHT","LEFT_BOTTOM","processBuffer","imageOptimizer","_req","_res","paramsResult","handleRequest","upstreamBuffer","upstreamType","upstreamRes","fetch","ok","status","Buffer","from","arrayBuffer","mocked","method","socket","res","parse","hasStreamed","concat","buffers","getHeader","cacheControl","dangerouslyAllowSVG","vector","animate","output","getMetadata","meta","opts","blurWidth","blurHeight","blurDataURL","unescape","getFileNameWithExtension","urlWithoutQueryParams","fileNameWithExtension","pop","fileName","setResponseHeaders","xCache","imagesConfig","setHeader","finished","contentDispositionType","contentSecurityPolicy","sendResponse","result","byteLength","end","getImageSize","metadata","decodeBuffer","Deferred","promise","Promise","resolve","reject"],"mappings":"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"}